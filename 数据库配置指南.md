# æ•°æ®åº“é…ç½®æŒ‡å—

## ğŸ“‹ é…ç½®å‰å‡†å¤‡

### 1. é€‰æ‹©æ•°æ®åº“ç±»å‹

æ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©ï¼š

- **Supabase PostgreSQL**ï¼ˆæ¨èï¼‰â­ - å…è´¹ã€äº‘ç«¯ã€è‡ªåŠ¨å¤‡ä»½
- **æœ¬åœ° PostgreSQL** - å®Œå…¨æ§åˆ¶ã€æ— ç½‘ç»œå»¶è¿Ÿ
- **MySQL** - å¹¿æ³›ä½¿ç”¨ã€èµ„æºå ç”¨å°‘

### 2. å‡†å¤‡ä¿¡æ¯

æ ¹æ®é€‰æ‹©çš„æ•°æ®åº“ç±»å‹ï¼Œå‡†å¤‡ç›¸åº”çš„è¿æ¥ä¿¡æ¯ã€‚

---

## ğŸš€ æ–¹å¼ 1: é…ç½® Supabase PostgreSQLï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1: åˆ›å»º Supabase é¡¹ç›®

1. è®¿é—® https://supabase.com/
2. ç‚¹å‡» **"Start your project"** æˆ– **"Sign in"**
3. ä½¿ç”¨ GitHub è´¦å·ç™»å½•ï¼ˆæ¨èï¼‰æˆ–åˆ›å»ºæ–°è´¦å·
4. ç‚¹å‡» **"New Project"**
5. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **Project Name**: ä¾‹å¦‚ `gongkao-db`
   - **Database Password**: è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆ**è®°ä½è¿™ä¸ªå¯†ç ï¼**ï¼‰
   - **Region**: é€‰æ‹©ç¦»æ‚¨æœ€è¿‘çš„åŒºåŸŸï¼ˆå¦‚ `Southeast Asia (Singapore)`ï¼‰
6. ç‚¹å‡» **"Create new project"**
7. ç­‰å¾…é¡¹ç›®åˆ›å»ºå®Œæˆï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰

### æ­¥éª¤ 2: è·å–æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

1. é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œç‚¹å‡»å·¦ä¾§èœå• **Settings** (âš™ï¸)
2. ç‚¹å‡» **Database**
3. å‘ä¸‹æ»šåŠ¨åˆ° **Connection string** éƒ¨åˆ†
4. é€‰æ‹© **Connection pooling** æ ‡ç­¾é¡µï¼ˆä¸æ˜¯ URI æ ‡ç­¾é¡µï¼‰
5. å¤åˆ¶è¿æ¥å­—ç¬¦ä¸²ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
   ```
   postgresql://postgres.xxxxx:[YOUR-PASSWORD]@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
   ```
6. **é‡è¦æç¤º**ï¼š
   - âœ… å¿…é¡»ä½¿ç”¨ **Connection pooling** æ¨¡å¼ï¼ˆç«¯å£ 6543ï¼‰
   - âŒ ä¸è¦ä½¿ç”¨ URI æ¨¡å¼ï¼ˆç«¯å£ 5432ï¼‰ï¼Œä¸æ”¯æŒè¿æ¥æ± 

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ï¼š

```env
# Supabase PostgreSQL æ•°æ®åº“è¿æ¥
DATABASE_URL=postgresql://postgres.xxxxx:your_password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
```

**å°† `your_password` æ›¿æ¢ä¸ºæ‚¨åœ¨æ­¥éª¤ 1 ä¸­è®¾ç½®çš„æ•°æ®åº“å¯†ç **

### æ­¥éª¤ 4: å®‰è£…ä¾èµ–

```bash
pip install psycopg2-binary
```

### æ­¥éª¤ 5: éªŒè¯é…ç½®

è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š

```bash
python check_database.py
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… ç›®æ ‡æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ“Š æ•°æ®åº“ç±»å‹: PostgreSQL
```

---

## ğŸ’» æ–¹å¼ 2: é…ç½®æœ¬åœ° PostgreSQL

### æ­¥éª¤ 1: å®‰è£… PostgreSQL

#### Windows

1. ä¸‹è½½å®‰è£…åŒ…ï¼šhttps://www.postgresql.org/download/windows/
2. è¿è¡Œå®‰è£…ç¨‹åº
3. è®°ä½è®¾ç½®çš„ postgres ç”¨æˆ·å¯†ç 
4. å®‰è£…å®Œæˆåï¼ŒPostgreSQL æœåŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨

æˆ–ä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼š
```powershell
choco install postgresql
```

#### macOS

```bash
brew install postgresql
brew services start postgresql
```

#### Linux (Ubuntu/Debian)

```bash
sudo apt-get update
sudo apt-get install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### æ­¥éª¤ 2: åˆ›å»ºæ•°æ®åº“

æ‰“å¼€ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ï¼š

#### Windows

```powershell
# ä½¿ç”¨ psqlï¼ˆå¦‚æœåœ¨ PATH ä¸­ï¼‰
psql -U postgres

# æˆ–è€…ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼ˆé€šå¸¸åœ¨å®‰è£…ç›®å½•ï¼‰
"C:\Program Files\PostgreSQL\16\bin\psql.exe" -U postgres
```

#### macOS/Linux

```bash
psql -U postgres
```

ç„¶åæ‰§è¡Œä»¥ä¸‹ SQL å‘½ä»¤ï¼š

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE gongkao_db;

-- åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ postgres ç”¨æˆ·ï¼‰
CREATE USER gongkao_user WITH PASSWORD 'your_password';

-- æˆäºˆæƒé™
GRANT ALL PRIVILEGES ON DATABASE gongkao_db TO gongkao_user;

-- é€€å‡º
\q
```

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# ä½¿ç”¨ postgres ç”¨æˆ·
DATABASE_URL=postgresql://postgres:your_password@localhost:5432/gongkao_db

# æˆ–ä½¿ç”¨è‡ªå®šä¹‰ç”¨æˆ·
DATABASE_URL=postgresql://gongkao_user:your_password@localhost:5432/gongkao_db
```

### æ­¥éª¤ 4: å®‰è£…ä¾èµ–

```bash
pip install psycopg2-binary
```

### æ­¥éª¤ 5: éªŒè¯é…ç½®

```bash
python check_database.py
```

---

## ğŸ¬ æ–¹å¼ 3: é…ç½® MySQL

### æ­¥éª¤ 1: å®‰è£… MySQL

#### Windows

1. ä¸‹è½½å®‰è£…åŒ…ï¼šhttps://dev.mysql.com/downloads/mysql/
2. è¿è¡Œå®‰è£…ç¨‹åº
3. è®°ä½è®¾ç½®çš„ root å¯†ç 

æˆ–ä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼š
```powershell
choco install mysql
```

#### macOS

```bash
brew install mysql
brew services start mysql
```

#### Linux (Ubuntu/Debian)

```bash
sudo apt-get update
sudo apt-get install mysql-server
sudo systemctl start mysql
sudo systemctl enable mysql
```

### æ­¥éª¤ 2: åˆ›å»ºæ•°æ®åº“

æ‰“å¼€ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ï¼š

```bash
mysql -u root -p
```

è¾“å…¥ root å¯†ç åï¼Œæ‰§è¡Œï¼š

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE gongkao_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER 'gongkao_user'@'localhost' IDENTIFIED BY 'your_password';

-- æˆäºˆæƒé™
GRANT ALL PRIVILEGES ON gongkao_db.* TO 'gongkao_user'@'localhost';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- é€€å‡º
EXIT;
```

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
DATABASE_URL=mysql+pymysql://gongkao_user:your_password@localhost:3306/gongkao_db?charset=utf8mb4
```

### æ­¥éª¤ 4: å®‰è£…ä¾èµ–

```bash
pip install pymysql
```

### æ­¥éª¤ 5: éªŒè¯é…ç½®

```bash
python check_database.py
```

---

## ğŸ” é…ç½®æ£€æŸ¥æ¸…å•

å®Œæˆé…ç½®åï¼Œä½¿ç”¨ä»¥ä¸‹æ¸…å•æ£€æŸ¥ï¼š

### âœ… åŸºç¡€æ£€æŸ¥

- [ ] `.env` æ–‡ä»¶å·²åˆ›å»º
- [ ] `DATABASE_URL` å·²é…ç½®
- [ ] æ•°æ®åº“æœåŠ¡å·²å¯åŠ¨ï¼ˆæœ¬åœ°æ•°æ®åº“ï¼‰
- [ ] å¿…è¦çš„ä¾èµ–åŒ…å·²å®‰è£…

### âœ… è¿æ¥æ£€æŸ¥

è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š

```bash
python check_database.py
```

åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… SQLite æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… ç›®æ ‡æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ“Š æ•°æ®åº“ç±»å‹: PostgreSQL/MySQL
âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼å¯ä»¥å¼€å§‹è¿ç§»
```

### âœ… éªŒè¯è¿æ¥å­—ç¬¦ä¸²æ ¼å¼

#### PostgreSQL æ ¼å¼

```
postgresql://[ç”¨æˆ·å]:[å¯†ç ]@[ä¸»æœº]:[ç«¯å£]/[æ•°æ®åº“å]
```

ç¤ºä¾‹ï¼š
```
postgresql://postgres:mypassword@localhost:5432/gongkao_db
postgresql://postgres.xxxxx:password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres
```

#### MySQL æ ¼å¼

```
mysql+pymysql://[ç”¨æˆ·å]:[å¯†ç ]@[ä¸»æœº]:[ç«¯å£]/[æ•°æ®åº“å]?charset=utf8mb4
```

ç¤ºä¾‹ï¼š
```
mysql+pymysql://gongkao_user:password@localhost:3306/gongkao_db?charset=utf8mb4
```

---

## âš ï¸ å¸¸è§é…ç½®é”™è¯¯

### é”™è¯¯ 1: è¿æ¥å­—ç¬¦ä¸²æ ¼å¼é”™è¯¯

**é”™è¯¯ç¤ºä¾‹**ï¼š
```
DATABASE_URL=postgresql://postgres password@localhost/gongkao_db  # âŒ ç¼ºå°‘ç«¯å£å’Œæ ¼å¼é”™è¯¯
```

**æ­£ç¡®æ ¼å¼**ï¼š
```
DATABASE_URL=postgresql://postgres:password@localhost:5432/gongkao_db  # âœ…
```

### é”™è¯¯ 2: Supabase ä½¿ç”¨äº†é”™è¯¯çš„ç«¯å£

**é”™è¯¯ç¤ºä¾‹**ï¼š
```
DATABASE_URL=postgresql://postgres:password@db.xxxxx.supabase.co:5432/postgres  # âŒ ç«¯å£ 5432
```

**æ­£ç¡®æ ¼å¼**ï¼ˆå¿…é¡»ä½¿ç”¨è¿æ¥æ± æ¨¡å¼ï¼‰ï¼š
```
DATABASE_URL=postgresql://postgres.xxxxx:password@aws-0-xxx.pooler.supabase.com:6543/postgres  # âœ… ç«¯å£ 6543
```

### é”™è¯¯ 3: å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦

å¦‚æœå¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `@`ã€`#`ã€`:` ç­‰ï¼‰ï¼Œéœ€è¦è¿›è¡Œ URL ç¼–ç ï¼š

**ç¤ºä¾‹**ï¼š
- åŸå§‹å¯†ç ï¼š`my@pass#123`
- URL ç¼–ç åï¼š`my%40pass%23123`

**æˆ–è€…ä½¿ç”¨å¼•å·**ï¼ˆæŸäº›æƒ…å†µä¸‹æœ‰æ•ˆï¼‰ï¼š
```
DATABASE_URL="postgresql://postgres:my@pass#123@localhost:5432/gongkao_db"
```

### é”™è¯¯ 4: æ•°æ®åº“ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FATAL: database "gongkao_db" does not exist
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç™»å½•æ•°æ®åº“
2. åˆ›å»ºæ•°æ®åº“ï¼ˆå‚è€ƒä¸Šé¢çš„æ­¥éª¤ï¼‰

---

## ğŸ” å®‰å…¨æç¤º

### 1. ä¸è¦æäº¤ .env æ–‡ä»¶

ç¡®ä¿ `.env` æ–‡ä»¶å·²åœ¨ `.gitignore` ä¸­ï¼š

```gitignore
.env
*.env
```

### 2. ä½¿ç”¨å¼ºå¯†ç 

- è‡³å°‘ 12 ä¸ªå­—ç¬¦
- åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 

### 3. ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§

å¦‚æœåŒæ—¶è®¾ç½®äº†ç¯å¢ƒå˜é‡å’Œ `.env` æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡ä¼˜å…ˆã€‚

---

## ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹

### .env æ–‡ä»¶å®Œæ•´ç¤ºä¾‹ï¼ˆSupabase PostgreSQLï¼‰

```env
# ==========================================
# æ•°æ®åº“é…ç½®
# ==========================================
DATABASE_URL=postgresql://postgres.xxxxx:your_password@aws-0-ap-southeast-1.pooler.supabase.com:6543/postgres

# ==========================================
# AI API é…ç½®
# ==========================================
AI_PROVIDER=deepseek
AI_API_KEY=sk-your-api-key-here
AI_API_BASE=https://api.deepseek.com/v1
AI_MODEL=deepseek-chat

# ==========================================
# OCR é¢„åŠ è½½é…ç½®
# ==========================================
PRELOAD_OCR=true
PRELOAD_OCR_TEST=false
```

---

## ğŸš€ é…ç½®å®Œæˆå

### 1. æ£€æŸ¥é…ç½®

```bash
python check_database.py
```

### 2. è¿è¡Œè¿ç§»ï¼ˆå¦‚æœæœ‰ SQLite æ•°æ®ï¼‰

```bash
python migrate_database.py
```

### 3. å¯åŠ¨åº”ç”¨

```bash
python app.py
```

### 4. éªŒè¯è¿æ¥

æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼
âœ… æ•°æ®åº“è¡¨å·²å°±ç»ªï¼
```

æˆ–é€šè¿‡å¥åº·æ£€æŸ¥æ¥å£ï¼š

```bash
curl http://localhost:5000/api/health
```

---

## ğŸ“„ ç›¸å…³æ–‡æ¡£

- `å¿«é€Ÿè¿ç§»æŒ‡å—.md` - å¿«é€Ÿè¿ç§»æ­¥éª¤
- `æ•°æ®åº“é€‰æ‹©ä¸è¿ç§»æŒ‡å—.md` - è¯¦ç»†çš„æ•°æ®åº“é€‰æ‹©å’Œè¿ç§»è¯´æ˜
- `æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–è¯´æ˜.md` - è¿æ¥æ± ä¼˜åŒ–è¯¦æƒ…

---

## â“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. è¿è¡Œ `python check_database.py` æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
3. éªŒè¯è¿æ¥å­—ç¬¦ä¸²æ ¼å¼æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—æ–‡ä»¶

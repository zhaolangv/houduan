# 内网穿透配置说明

## 推荐工具

### 1. ngrok（推荐，简单易用）

**优点**：
- 使用简单，无需配置
- 支持 HTTPS
- 有免费版

**使用方法**：

1. 注册账号：https://ngrok.com/
2. 下载客户端：https://ngrok.com/download
3. 获取 authtoken（注册后可在 Dashboard 获取）
4. 配置：
   ```bash
   ngrok config add-authtoken <your-token>
   ```
5. 启动隧道：
   ```bash
   ngrok http 5000
   ```
6. 会显示公网URL，如：`https://xxxx.ngrok-free.app`

**Windows 使用**：
```powershell
# 下载 ngrok.exe 后
.\ngrok.exe http 5000
```

**⚠️ ngrok 免费版警告页面问题**：

ngrok 免费版会在首次访问时显示一个警告页面，需要手动点击 "Visit Site" 按钮。

**解决方案**：

1. **方法1：添加请求头跳过警告**（推荐）
   ```powershell
   # PowerShell 测试
   $headers = @{'ngrok-skip-browser-warning'='true'}
   Invoke-WebRequest -Uri https://xxxx.ngrok-free.app/api/test -Headers $headers
   
   # 或使用测试脚本
   .\test_ngrok.ps1 https://xxxx.ngrok-free.app
   ```

2. **方法2：浏览器首次访问**
   - 在浏览器中访问 ngrok URL
   - 点击 "Visit Site" 按钮（仅首次需要）
   - 之后就可以正常使用 API

3. **方法3：使用付费版**
   - ngrok 付费版不会显示警告页面
   - 适合生产环境使用

**测试 ngrok 连接**：
```powershell
# 使用专用测试脚本（自动处理警告页面）
.\test_ngrok.ps1 https://a5413eed8eb6.ngrok-free.app

# 或使用通用测试脚本
.\test_tunnel_public.bat https://a5413eed8eb6.ngrok-free.app
```

---

### 2. cpolar（国内，推荐）

**优点**：
- 国内服务，速度快
- 免费版支持
- 中文界面

**使用方法**：

1. 注册账号：https://www.cpolar.com/
2. 下载客户端：https://www.cpolar.com/download
3. 登录：
   ```bash
   cpolar authtoken <your-token>
   ```
4. 启动隧道：
   ```bash
   cpolar http 5000
   ```
5. 会显示公网URL

**Windows 使用**：
```powershell
# 下载 cpolar.exe 后
.\cpolar.exe http 5000
```

---

### 3. frp（开源，需要服务器）

**优点**：
- 完全免费
- 可自建服务器
- 无流量限制

**缺点**：
- 需要有自己的服务器
- 配置较复杂

**使用方法**：

1. 下载：https://github.com/fatedier/frp/releases
2. 在服务器上配置 `frps.ini`
3. 在本地配置 `frpc.ini`
4. 启动服务端和客户端

---

### 4. localtunnel（无需注册，最简单）

**优点**：
- 无需注册
- 使用 npx 无需全局安装
- 完全免费

**缺点**：
- 需要 Node.js 环境
- URL 每次启动都会变化
- 可能不稳定

**使用方法**：

```bash
# 方法1：使用 npx（推荐，无需安装）
npx localtunnel --port 5000

# 方法2：全局安装后使用
npm install -g localtunnel
lt --port 5000
```

会显示公网URL，如：`https://xxxx.loca.lt`

**Windows 使用**：
```powershell
# 使用项目提供的脚本（推荐）
.\start_tunnel_localtunnel.bat

# 或直接运行
npx localtunnel --port 5000
```

**常见问题**：

1. **`lt: 无法识别命令`**：
   - 使用 `npx localtunnel --port 5000` 代替
   - 或运行 `.\start_tunnel_localtunnel.bat`

2. **Node.js 版本警告**：
   - 警告不影响使用，`npx` 仍可正常工作
   - 如需升级：https://nodejs.org/

---

### 5. serveo（SSH隧道，无需安装）

**优点**：
- 无需安装
- 使用 SSH
- 完全免费

**使用方法**：

```bash
# Windows PowerShell
ssh -R 80:localhost:5000 serveo.net

# 或指定子域名
ssh -R yourname:80:localhost:5000 serveo.net
```

---

## 快速开始（推荐 cpolar）

### 步骤1：下载 cpolar

访问：https://www.cpolar.com/download

下载 Windows 版本

### 步骤2：注册并获取 token

1. 访问：https://www.cpolar.com/
2. 注册账号
3. 在控制台获取 authtoken

### 步骤3：配置

```powershell
# 在项目目录下
.\cpolar.exe authtoken <your-token>
```

### 步骤4：启动隧道

```powershell
# 启动 Flask 服务
python app.py

# 在另一个终端启动 cpolar
.\cpolar.exe http 5000
```

### 步骤5：获取公网URL

cpolar 会显示类似：
```
Forwarding    https://xxxx.cpolar.io -> http://localhost:5000
```

使用这个 URL 即可从外网访问你的 Flask 服务。

---

## 注意事项

1. **安全性**：内网穿透会将本地服务暴露到公网，注意：
   - 不要在生产环境使用
   - 设置适当的访问控制
   - 不要暴露敏感数据

2. **性能**：免费版通常有：
   - 流量限制
   - 连接数限制
   - 域名随机变化（每次启动可能不同）

3. **稳定性**：免费服务可能：
   - 有连接时间限制
   - 需要定期重启
   - 可能不稳定

---

## 测试内网穿透

启动内网穿透后，可以使用以下命令测试：

```bash
# 测试统计接口
curl https://your-tunnel-url.cpolar.io/api/stats

# 测试题目分析接口
curl -X POST https://your-tunnel-url.cpolar.io/api/questions/analyze \
  -F "image=@uploads/ceshi/test.jpg"
```

---

## 推荐方案

- **快速测试**：使用 `localtunnel` 或 `serveo`（无需注册）
- **稳定使用**：使用 `cpolar`（国内，速度快）
- **生产环境**：使用 `frp` 自建服务器（完全控制）


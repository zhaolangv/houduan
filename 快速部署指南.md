# å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²åˆ°Supabase

### å‰ç½®æ¡ä»¶

- âœ… Supabaseè´¦å·ï¼ˆå…è´¹ï¼‰
- âœ… GitHubè´¦å·
- âœ… éƒ¨ç½²å¹³å°è´¦å·ï¼ˆè§ä¸‹æ–¹è¯´æ˜ï¼‰

### ğŸ’° éƒ¨ç½²å¹³å°é€‰æ‹©

#### Railwayï¼ˆæ¨èï¼Œä½†éœ€ä»˜è´¹ï¼‰
- **å…è´¹è¯•ç”¨**ï¼šæ–°ç”¨æˆ·30å¤©å…è´¹ï¼ŒåŒ…å«$5ä½¿ç”¨é¢åº¦
- **æ­£å¼ä½¿ç”¨**ï¼š$5/æœˆï¼ˆHobbyè®¡åˆ’ï¼‰ï¼ŒåŒ…å«$5ä½¿ç”¨é¢åº¦
- **ä¼˜ç‚¹**ï¼šéƒ¨ç½²ç®€å•ï¼Œè‡ªåŠ¨HTTPSï¼Œé€Ÿåº¦å¿«
- **é€‚åˆ**ï¼šæ„¿æ„ä»˜è´¹çš„ç”¨æˆ·

#### Renderï¼ˆå…è´¹è®¡åˆ’å¯ç”¨ï¼‰
- **å…è´¹è®¡åˆ’**ï¼šâœ… å®Œå…¨å…è´¹
- **é™åˆ¶**ï¼šåº”ç”¨ä¼‘çœ åé¦–æ¬¡è¯·æ±‚è¾ƒæ…¢ï¼ˆçº¦30ç§’å†·å¯åŠ¨ï¼‰
- **ä¼˜ç‚¹**ï¼šçœŸæ­£å…è´¹ï¼Œé€‚åˆä¸ªäººé¡¹ç›®
- **é€‚åˆ**ï¼šé¢„ç®—æœ‰é™çš„ç”¨æˆ·

#### Fly.ioï¼ˆå…è´¹è®¡åˆ’å¯ç”¨ï¼‰
- **å…è´¹è®¡åˆ’**ï¼šâœ… æœ‰å…è´¹é¢åº¦
- **ä¼˜ç‚¹**ï¼šå…¨çƒCDNï¼Œæ€§èƒ½å¥½
- **é€‚åˆ**ï¼šéœ€è¦å…¨çƒéƒ¨ç½²çš„ç”¨æˆ·

**å»ºè®®**ï¼š
- é¢„ç®—å……è¶³ â†’ é€‰æ‹© **Railway**ï¼ˆæœ€ç®€å•ï¼‰
- é¢„ç®—æœ‰é™ â†’ é€‰æ‹© **Render**ï¼ˆå…è´¹ä½†å†·å¯åŠ¨æ…¢ï¼‰
- éœ€è¦å…¨çƒéƒ¨ç½² â†’ é€‰æ‹© **Fly.io**

---

## âš¡ å¿«é€Ÿæ£€æŸ¥ï¼šæ˜¯å¦å·²é…ç½®ï¼Ÿ

å¦‚æœä½ å·²ç»é…ç½®è¿‡Supabaseï¼Œå¯ä»¥è·³è¿‡é…ç½®æ­¥éª¤ï¼Œç›´æ¥éƒ¨ç½²ï¼

### æ£€æŸ¥é…ç½®

è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š

```bash
python check_deployment.py
```

å¦‚æœçœ‹åˆ°æ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡ âœ…ï¼Œè¯´æ˜é…ç½®å·²å®Œæˆï¼Œå¯ä»¥ç›´æ¥è·³åˆ° **[æ­¥éª¤3: éƒ¨ç½²åˆ°Railway](#æ­¥éª¤3-éƒ¨ç½²åˆ°railway3åˆ†é’Ÿ)**

### å·²é…ç½®çš„é¡¹

ä»ä½ çš„ `.env` æ–‡ä»¶ä¸­ï¼Œæˆ‘çœ‹åˆ°ä½ å·²ç»é…ç½®äº†ï¼š

- âœ… `DATABASE_URL` - Supabaseæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- âœ… `SUPABASE_URL` - Supabaseé¡¹ç›®URL  
- âœ… `SUPABASE_ANON_KEY` - SupabaseåŒ¿åå¯†é’¥
- âœ… `SUPABASE_STORAGE_BUCKET` - å­˜å‚¨æ¡¶åç§°

**å¦‚æœé…ç½®æ­£ç¡®ï¼Œå¯ä»¥ç›´æ¥è·³åˆ°éƒ¨ç½²æ­¥éª¤ï¼** ğŸ‰

---

## æ­¥éª¤1: é…ç½®Supabaseï¼ˆ5åˆ†é’Ÿï¼‰

> **æ³¨æ„**ï¼šå¦‚æœä½ å·²ç»é…ç½®å¥½äº†ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ï¼Œç›´æ¥çœ‹æ­¥éª¤3ã€‚

### 1.1 åˆ›å»ºSupabaseé¡¹ç›®

### 1.1 åˆ›å»ºSupabaseé¡¹ç›®

1. è®¿é—® https://supabase.com
2. åˆ›å»ºæ–°é¡¹ç›®
3. **è®°ä½æ•°æ®åº“å¯†ç **ï¼ˆé‡è¦ï¼ï¼‰

### 1.2 è·å–è¿æ¥ä¿¡æ¯

åœ¨Supabase Dashboardä¸­ï¼š

1. **æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²**ï¼š
   - Settings â†’ Database â†’ Connection string
   - é€‰æ‹© **Session pooler** æ¨¡å¼
   - å¤åˆ¶è¿æ¥å­—ç¬¦ä¸²
   - **æ›¿æ¢** `[YOUR-PASSWORD]` ä¸ºå®é™…å¯†ç 

2. **APIå¯†é’¥**ï¼š
   - Settings â†’ API
   - å¤åˆ¶ **Project URL** å’Œ **anon public key**

3. **åˆ›å»ºStorageå­˜å‚¨æ¡¶**ï¼š
   - Storage â†’ New bucket
   - åç§°ï¼š`question-images`
   - âœ… å‹¾é€‰ Public bucket

---

## æ­¥éª¤2: é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ2åˆ†é’Ÿï¼‰

> **æ³¨æ„**ï¼šå¦‚æœä½ å·²ç»é…ç½®å¥½äº† `.env` æ–‡ä»¶ï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ï¼Œç›´æ¥çœ‹æ­¥éª¤3ã€‚

### 2.1 åˆ›å»º.envæ–‡ä»¶

å¦‚æœè¿˜æ²¡æœ‰ `.env` æ–‡ä»¶ï¼Œå¤åˆ¶ `env.example` ä¸º `.env`ï¼š

```bash
cp env.example .env
```

### 2.2 ç¼–è¾‘.envæ–‡ä»¶

å¡«å…¥ä»¥ä¸‹é…ç½®ï¼š

```env
# æ•°æ®åº“ï¼ˆæ›¿æ¢ä¸ºä½ çš„å®é™…å€¼ï¼‰
DATABASE_URL=postgresql://postgres.[PROJECT-REF]:[PASSWORD]@aws-1-ap-northeast-2.pooler.supabase.com:5432/postgres

# Supabase Storage
SUPABASE_URL=https://[PROJECT-REF].supabase.co
SUPABASE_ANON_KEY=ä½ çš„anon public key
SUPABASE_STORAGE_BUCKET=question-images

# AIé…ç½®ï¼ˆDeepSeekï¼‰
AI_PROVIDER=deepseek
AI_API_KEY=ä½ çš„DeepSeek API Key
AI_API_BASE=https://api.deepseek.com/v1
AI_MODEL=deepseek-chat
```

### 2.3 éªŒè¯é…ç½®

è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š

```bash
python check_deployment.py
```

ç¡®ä¿æ‰€æœ‰æ£€æŸ¥é€šè¿‡ âœ…

---

## æ­¥éª¤3: éƒ¨ç½²åˆ°å¹³å°ï¼ˆ3åˆ†é’Ÿï¼‰

> **é€‰æ‹©éƒ¨ç½²å¹³å°**ï¼š
> - **Railway**ï¼š$5/æœˆï¼Œæœ€ç®€å•ï¼ˆæ¨èï¼‰
> - **Render**ï¼šå…è´¹ï¼Œä½†å†·å¯åŠ¨æ…¢
> - **Fly.io**ï¼šå…è´¹ï¼Œæ€§èƒ½å¥½

### æ–¹æ¡ˆA: éƒ¨ç½²åˆ°Railwayï¼ˆæ¨èï¼Œéœ€ä»˜è´¹ï¼‰

> **æ³¨æ„**ï¼šRailwayæä¾›30å¤©å…è´¹è¯•ç”¨ï¼ˆ$5é¢åº¦ï¼‰ï¼Œä¹‹åéœ€è¦$5/æœˆ

### 3.1 æ¨é€ä»£ç åˆ°GitHub

> **è¯¦ç»†æ­¥éª¤**ï¼šå¦‚æœè¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªGitHubä»“åº“ï¼Œæˆ–è€…éœ€è¦è¯¦ç»†è¯´æ˜ï¼Œè¯·æŸ¥çœ‹ [`GitHubæ¨é€æŒ‡å—.md`](GitHubæ¨é€æŒ‡å—.md)

#### å¿«é€Ÿæ­¥éª¤ï¼š

```bash
# 1. åˆå§‹åŒ–Gitï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git init

# 2. æ·»åŠ æ–‡ä»¶ï¼ˆ.gitignoreä¼šè‡ªåŠ¨æ’é™¤.envç­‰æ•æ„Ÿæ–‡ä»¶ï¼‰
git add .

# 3. æäº¤
git commit -m "Initial commit: å…¬è€ƒé¢˜åº“åˆ†ææœåŠ¡"

# 4. åœ¨GitHubä¸Šåˆ›å»ºæ–°ä»“åº“ï¼ˆè®¿é—® https://github.com/newï¼‰
#    ä»“åº“åï¼šgongkao-backendï¼ˆæˆ–ä½ å–œæ¬¢çš„åç§°ï¼‰
#    ä¸è¦å‹¾é€‰ "Initialize with README"

# 5. æ·»åŠ è¿œç¨‹ä»“åº“å¹¶æ¨é€ï¼ˆæ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·åå’Œä»“åº“åï¼‰
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/gongkao-backend.git
git branch -M main
git push -u origin main
```

**æ³¨æ„**ï¼š
- å¦‚æœæç¤º "remote origin already exists"ï¼Œè¯´æ˜å½“å‰ç›®å½•å·²ç»æœ‰Gité…ç½®ï¼Œéœ€è¦å…ˆåˆ é™¤ï¼š`git remote remove origin`
- å¦‚æœç”µè„‘ä¸Šå·²æœ‰å…¶ä»–é¡¹ç›®çš„Gitä»“åº“ï¼Œè¯·å‚è€ƒ [`GitHubæ¨é€æŒ‡å—.md`](GitHubæ¨é€æŒ‡å—.md) çš„è¯¦ç»†è¯´æ˜

### 3.2 åˆ›å»ºRailwayé¡¹ç›®

1. è®¿é—® https://railway.app
2. ä½¿ç”¨GitHubç™»å½•
3. New Project â†’ Deploy from GitHub repo
4. é€‰æ‹©ä½ çš„ä»“åº“

### 3.3 é…ç½®ç¯å¢ƒå˜é‡

åœ¨Railwayé¡¹ç›®è®¾ç½®ä¸­ï¼Œæ·»åŠ æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ˆä».envæ–‡ä»¶å¤åˆ¶ï¼‰

### 3.4 éƒ¨ç½²

Railwayä¼šè‡ªåŠ¨ï¼š
- æ£€æµ‹Pythoné¡¹ç›®
- å®‰è£…ä¾èµ–
- å¯åŠ¨åº”ç”¨

å®Œæˆåä¼šæä¾› `https://your-app.railway.app` URL

---

### æ–¹æ¡ˆB: éƒ¨ç½²åˆ°Renderï¼ˆå…è´¹ï¼‰

> **ä¼˜ç‚¹**ï¼šå®Œå…¨å…è´¹ï¼Œé€‚åˆä¸ªäººé¡¹ç›®  
> **ç¼ºç‚¹**ï¼šåº”ç”¨ä¼‘çœ åé¦–æ¬¡è¯·æ±‚è¾ƒæ…¢ï¼ˆçº¦30ç§’å†·å¯åŠ¨ï¼‰

#### 3.1 æ¨é€ä»£ç åˆ°GitHub

ï¼ˆåŒRailwayçš„æ­¥éª¤3.1ï¼‰

#### 3.2 åˆ›å»ºRenderæœåŠ¡

1. è®¿é—® https://render.com
2. ä½¿ç”¨GitHubè´¦å·ç™»å½•
3. ç‚¹å‡» **New** â†’ **Web Service**
4. é€‰æ‹©ä½ çš„GitHubä»“åº“
5. é…ç½®æœåŠ¡ï¼š
   - **Name**: `gongkao-backend`ï¼ˆæˆ–ä½ å–œæ¬¢çš„åç§°ï¼‰
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn -w 4 -b 0.0.0.0:$PORT --timeout 120 app:app`
   - **Plan**: é€‰æ‹© **Free**

#### 3.3 é…ç½®ç¯å¢ƒå˜é‡

åœ¨Render Dashboardä¸­ï¼Œè¿›å…¥ **Environment** æ ‡ç­¾ï¼Œæ·»åŠ æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ˆä».envæ–‡ä»¶å¤åˆ¶ï¼‰

#### 3.4 éƒ¨ç½²

Renderä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œå®Œæˆåä¼šæä¾› `https://your-app.onrender.com` URL

**æ³¨æ„**ï¼šå…è´¹è®¡åˆ’çš„åº”ç”¨åœ¨15åˆ†é’Ÿæ— æ´»åŠ¨åä¼šä¼‘çœ ï¼Œé¦–æ¬¡è¯·æ±‚éœ€è¦çº¦30ç§’å”¤é†’ã€‚

---

### æ–¹æ¡ˆC: éƒ¨ç½²åˆ°Fly.ioï¼ˆå…è´¹ï¼‰

> **ä¼˜ç‚¹**ï¼šå…è´¹ï¼Œå…¨çƒCDNï¼Œæ€§èƒ½å¥½  
> **ç¼ºç‚¹**ï¼šé…ç½®ç¨å¤æ‚

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ `Supabaseéƒ¨ç½²æŒ‡å—.md` ä¸­çš„ Fly.io éƒ¨ç½²éƒ¨åˆ†ã€‚

---

## æ­¥éª¤4: éªŒè¯éƒ¨ç½²ï¼ˆ1åˆ†é’Ÿï¼‰

### 4.1 å¥åº·æ£€æŸ¥

æ ¹æ®ä½ é€‰æ‹©çš„å¹³å°ï¼Œä½¿ç”¨å¯¹åº”çš„URLï¼š

```bash
# Railway
curl https://your-app.railway.app/api/health

# Render
curl https://your-app.onrender.com/api/health

# Fly.io
curl https://your-app.fly.dev/api/health
```

åº”è¯¥è¿”å›ï¼š

```json
{
  "status": "healthy",
  "checks": {
    "database": {"status": "connected"}
  }
}
```

### 4.2 æµ‹è¯•æ¥å£

```bash
# æ›¿æ¢ä¸ºä½ çš„å®é™…URL
curl https://your-app.railway.app/api/test
# æˆ–
curl https://your-app.onrender.com/api/test
```

---

## âœ… å®Œæˆï¼

ä½ çš„åº”ç”¨å·²æˆåŠŸéƒ¨ç½²ï¼

### ä¸‹ä¸€æ­¥

1. **é…ç½®è‡ªå®šä¹‰åŸŸå**ï¼ˆå¯é€‰ï¼‰
   - Railway: Settings â†’ Domains
   - Render: Settings â†’ Custom Domains
   - Fly.io: ä½¿ç”¨ `fly domains add`

2. **æŸ¥çœ‹æ—¥å¿—**
   - Railway: Deployments â†’ View Logs
   - Render: Logs æ ‡ç­¾
   - Fly.io: `fly logs`

3. **ç›‘æ§ä½¿ç”¨æƒ…å†µ**
   - å„å¹³å°çš„Dashboard

---

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### âš ï¸ éƒ¨ç½²å¤±è´¥ï¼Ÿ

å¦‚æœçœ‹åˆ° **"There was an error deploying from source"** é”™è¯¯ï¼š

1. **ç«‹å³æŸ¥çœ‹**ï¼š`éƒ¨ç½²å¤±è´¥å¿«é€Ÿæ’æŸ¥.md` - å¿«é€Ÿå®šä½é—®é¢˜
2. **è¯¦ç»†æ•…éšœæ’é™¤**ï¼š`éƒ¨ç½²æ•…éšœæ’é™¤.md` - å®Œæ•´è§£å†³æ–¹æ¡ˆ

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ `DATABASE_URL` ä¸­çš„ç”¨æˆ·åæ ¼å¼ï¼ˆå¿…é¡»æ˜¯ `postgres.[PROJECT-REF]`ï¼‰
   - ç¡®è®¤å¯†ç å·²æ›¿æ¢ï¼ˆä¸æ˜¯ `[YOUR-PASSWORD]`ï¼‰

2. **Storageä¸Šä¼ å¤±è´¥**
   - ç¡®è®¤å­˜å‚¨æ¡¶åç§°æ­£ç¡®
   - æ£€æŸ¥å­˜å‚¨æ¡¶æ˜¯å¦ä¸ºå…¬å¼€ï¼ˆPublicï¼‰

3. **åº”ç”¨å¯åŠ¨å¤±è´¥**
   - æŸ¥çœ‹Railwayæ—¥å¿—ï¼ˆDeployments â†’ View Logsï¼‰
   - ç¡®è®¤æ‰€æœ‰ç¯å¢ƒå˜é‡å·²é…ç½®

4. **ä¾èµ–å®‰è£…å¤±è´¥**
   - æ£€æŸ¥ `requirements.txt` ä¸­çš„ç‰ˆæœ¬å·
   - å·²ä¿®å¤ï¼š`tkinterdnd2` å·²æ³¨é‡Šï¼ˆGUIåº“ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦ï¼‰

### è·å–å¸®åŠ©

- **å¿«é€Ÿæ’æŸ¥**ï¼š`éƒ¨ç½²å¤±è´¥å¿«é€Ÿæ’æŸ¥.md` âš¡
- **è¯¦ç»†æ–‡æ¡£**ï¼š`Supabaseéƒ¨ç½²æŒ‡å—.md`
- **æ•…éšœæ’é™¤**ï¼š`éƒ¨ç½²æ•…éšœæ’é™¤.md`
- **æ£€æŸ¥è„šæœ¬**ï¼š`python check_deployment.py`
- **Supabaseæ–‡æ¡£**ï¼šhttps://supabase.com/docs

---

## ğŸ“ ç¯å¢ƒå˜é‡æ¸…å•

éƒ¨ç½²å‰ç¡®ä¿ä»¥ä¸‹å˜é‡å·²é…ç½®ï¼š

- [ ] `DATABASE_URL` - Supabaseæ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- [ ] `SUPABASE_URL` - Supabaseé¡¹ç›®URL
- [ ] `SUPABASE_ANON_KEY` - SupabaseåŒ¿åå¯†é’¥
- [ ] `SUPABASE_STORAGE_BUCKET` - å­˜å‚¨æ¡¶åç§°ï¼ˆé»˜è®¤ï¼šquestion-imagesï¼‰
- [ ] `AI_PROVIDER` - AIæä¾›å•†ï¼ˆdeepseek/openaiï¼‰
- [ ] `AI_API_KEY` - AI APIå¯†é’¥
- [ ] `AI_API_BASE` - AI APIåŸºç¡€URL
- [ ] `AI_MODEL` - AIæ¨¡å‹åç§°

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

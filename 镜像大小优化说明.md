# Railway é•œåƒå¤§å°ä¼˜åŒ–è¯´æ˜Ž

## ðŸš¨ é—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Image of size 8.6 GB exceeded limit of 4.0 GB. Upgrade your plan to increase the image size limit.
```

**åŽŸå› **ï¼š`torch`ã€`torchvision` å’Œ `sentence-transformers` ç­‰æ·±åº¦å­¦ä¹ åº“ä½“ç§¯è¿‡å¤§ï¼ˆçº¦6-7GBï¼‰

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ç§»é™¤å¤§åž‹ä¾èµ–ï¼ˆæŽ¨èï¼Œå·²åº”ç”¨ï¼‰

æˆ‘å·²ç»æ›´æ–°äº† `requirements.txt`ï¼Œæ³¨é‡ŠæŽ‰äº†ä»¥ä¸‹å¤§åž‹ä¾èµ–ï¼š

```txt
# sentence-transformers==2.2.2  # çº¦2GB
# torch>=2.2.0,<3.0.0  # çº¦3-4GB
# torchvision>=0.17.0,<1.0.0  # çº¦500MB
```

**å½±å“**ï¼š
- âœ… é•œåƒå¤§å°é™è‡³çº¦ **500MB-1GB**
- âš ï¸ **embeddingåŠŸèƒ½å°†ä¸å¯ç”¨**ï¼ˆå›¾ç‰‡ç›¸ä¼¼åº¦æœç´¢ï¼‰
- âœ… **æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸**ï¼šé¢˜ç›®åˆ†æžã€AIè§£æžã€æ•°æ®åº“å­˜å‚¨ç­‰

**é€‚ç”¨åœºæ™¯**ï¼š
- å¦‚æžœä¸éœ€è¦å›¾ç‰‡ç›¸ä¼¼åº¦æœç´¢åŠŸèƒ½
- å¦‚æžœä¸»è¦ä½¿ç”¨AIåˆ†æžé¢˜ç›®å†…å®¹

---

### æ–¹æ¡ˆ2: ä½¿ç”¨ç²¾ç®€ç‰ˆrequirementsï¼ˆå¤‡é€‰ï¼‰

å¦‚æžœæ–¹æ¡ˆ1ä»æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ `requirements-production.txt`ï¼š

**ä¿®æ”¹ `railway.json`**ï¼š
```json
{
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "pip install -r requirements-production.txt"
  }
}
```

---

### æ–¹æ¡ˆ3: å‡çº§Railwayè®¡åˆ’

å¦‚æžœéœ€è¦ä¿ç•™embeddingåŠŸèƒ½ï¼š

1. **å‡çº§åˆ°Proè®¡åˆ’**ï¼ˆ$20/æœˆï¼‰
   - é•œåƒå¤§å°é™åˆ¶ï¼š10GB
   - å¯ä»¥ä¿ç•™æ‰€æœ‰ä¾èµ–

2. **æˆ–ä½¿ç”¨å…¶ä»–å¹³å°**ï¼š
   - **Render**ï¼šå…è´¹ï¼Œä½†å†·å¯åŠ¨æ…¢
   - **Fly.io**ï¼šå…è´¹ï¼Œæ”¯æŒæ›´å¤§é•œåƒ
   - **AWS/GCP**ï¼šæŒ‰éœ€ä»˜è´¹

---

## ðŸ“Š ä¾èµ–å¤§å°å¯¹æ¯”

| ä¾èµ–åŒ… | å¤§å° | ç”¨é€” | æ˜¯å¦å¿…éœ€ |
|--------|------|------|----------|
| torch | ~3-4GB | æ·±åº¦å­¦ä¹ æ¡†æž¶ | âŒ ä»…ç”¨äºŽembedding |
| torchvision | ~500MB | å›¾åƒå¤„ç† | âŒ ä»…ç”¨äºŽembedding |
| sentence-transformers | ~2GB | æ–‡æœ¬/å›¾ç‰‡embedding | âŒ ä»…ç”¨äºŽembedding |
| flask + å…¶ä»– | ~200MB | æ ¸å¿ƒæ¡†æž¶ | âœ… å¿…éœ€ |
| **æ€»è®¡ï¼ˆç§»é™¤torchï¼‰** | **~500MB-1GB** | - | - |
| **æ€»è®¡ï¼ˆåŒ…å«torchï¼‰** | **~6-7GB** | - | - |

---

## ðŸ” æ£€æŸ¥embeddingåŠŸèƒ½æ˜¯å¦è¢«ä½¿ç”¨

ä»Žä»£ç æ£€æŸ¥æ¥çœ‹ï¼Œ`embedding_service.py` åœ¨ `app.py` ä¸­**æ²¡æœ‰è¢«å¯¼å…¥**ï¼Œè¯´æ˜Žï¼š

âœ… **å¯ä»¥å®‰å…¨ç§»é™¤torchä¾èµ–**ï¼Œä¸ä¼šå½±å“æ ¸å¿ƒåŠŸèƒ½

---

## ðŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æäº¤æ›´æ”¹

```bash
git add requirements.txt
git commit -m "ä¼˜åŒ–ä¾èµ–ï¼šç§»é™¤torchç­‰å¤§åž‹åŒ…ä»¥å‡å°é•œåƒå¤§å°"
git push origin main
```

### 2. Railwayä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²

Railwayä¼šæ£€æµ‹åˆ°æ–°çš„æäº¤å¹¶é‡æ–°æž„å»ºé•œåƒã€‚

### 3. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl https://your-app.railway.app/api/health

# æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
curl https://your-app.railway.app/api/test
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **embeddingåŠŸèƒ½ä¸å¯ç”¨**
   - å›¾ç‰‡ç›¸ä¼¼åº¦æœç´¢å°†æ— æ³•ä½¿ç”¨
   - å¦‚æžœåŽç»­éœ€è¦ï¼Œå¯ä»¥å‡çº§è®¡åˆ’æˆ–ä½¿ç”¨å…¶ä»–å¹³å°

2. **numpyä¾èµ–**
   - å¦‚æžœå…¶ä»–åŒ…ä¸éœ€è¦numpyï¼Œä¹Ÿå¯ä»¥æ³¨é‡ŠæŽ‰
   - ä½†é€šå¸¸Pillowç­‰åŒ…ä¼šä¾èµ–numpy

3. **æœ¬åœ°å¼€å‘**
   - æœ¬åœ°å¼€å‘æ—¶ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Štorchç›¸å…³ä¾èµ–
   - ä½¿ç”¨ `requirements.txt` çš„å®Œæ•´ç‰ˆæœ¬

---

## ðŸ“ å¦‚æžœä»ç„¶è¶…è¿‡é™åˆ¶

å¦‚æžœç§»é™¤torchåŽä»ç„¶è¶…è¿‡4GBï¼Œæ£€æŸ¥ï¼š

1. **Pythonç‰ˆæœ¬**
   - ä½¿ç”¨ `runtime.txt` æŒ‡å®šPythonç‰ˆæœ¬
   - é¿å…å®‰è£…å¤šä¸ªPythonç‰ˆæœ¬

2. **å…¶ä»–å¤§åž‹ä¾èµ–**
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å¤§åž‹åŒ…
   - ä½¿ç”¨ `pip list` æŸ¥çœ‹å·²å®‰è£…åŒ…çš„å¤§å°

3. **ä½¿ç”¨å¤šé˜¶æ®µæž„å»º**
   - è€ƒè™‘ä½¿ç”¨Dockerfileè¿›è¡Œå¤šé˜¶æ®µæž„å»º
   - åªå¤åˆ¶å¿…è¦çš„æ–‡ä»¶

---

## âœ… å®Œæˆ

çŽ°åœ¨ä½ çš„ `requirements.txt` å·²ç»ä¼˜åŒ–ï¼Œé•œåƒå¤§å°åº”è¯¥é™è‡³ **500MB-1GB**ï¼Œå¯ä»¥æˆåŠŸéƒ¨ç½²åˆ°Railwayï¼

**ä¸‹ä¸€æ­¥**ï¼š
1. æäº¤å¹¶æŽ¨é€ä»£ç 
2. Railwayä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²
3. éªŒè¯åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
